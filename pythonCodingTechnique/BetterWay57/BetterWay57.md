## Better way 57
### pdb를 이용한 대화식 디버깅을 고려하자

#### 핵심정리 (두괄식)
- **제일 핵심** 그냥 파이참이나 인텔리제이 디버거 쓰자. 뭐하러 귀찮게 임포트하고 라인 추가하나...
  - 물론 아톰이나 VSC를 쓴다면 플러그인을 쓰던지 이 모듈을 사용하던지 해야하겠지만...
  - 직접 써보니깐 더 그렇다. 그냥 파이참 디버거 쓸래...
- import pdb; pdb.set_trace() 문으로 프로그램의 관심 지점에서 직접 파이썬 대화식 디버거를 시작할 수 있다.
- 파이썬 디버거 프롬프트는 실행 중인 프로그램의 상태를 조사하거나 수정할 수 있도록 해주는 완전한 파이썬 쉘이다.
- pdb 쉘 명령을 이용하면 프로그램 실행을 세밀하게 제어할 수 있다. 또한 프로그램의 상태를 조사하거나 프로그램 실행을 이어가는 과정을 교대로 반복 할 수 있다.

***

누구나 프로그램을 개발할 때 코드에서 버그를 접하기 마련이다.
print함수를 사용하면 많은 문제의 원인을 추적하는 데 도움이 된다.
(repr 문자열을 디버깅 출력용으로 고려하기)

문제를 분리하는 또 다른 훌륭한 방법은 무제를 일으키는 특별한 경우를 대비하여 테스트를 작성하는 것이다.
(unittest로 모든 걸 테스트 해보자)

하지만 이런 도구만으로는 근본적인 원인을 모두 찾아내지 못한다.
더 강력한 도구가 필요하다면 파이썬에 내장된 대화식 디버거 (interactive debugger)를 사용해보자.
디버거를 이용하면 프로그램의 상태를 조사하고,
지역변수를 출력하고, 파이썬 프로그램을 한 번에 한 문장씩 실행할 수 있다.

대부분의 다른 프로그래밍 언어에서는 멈추게 할 소스 파일의 줄을 설정한 다음 프로그램을 실행하는 방법으 디버거를 사용한다.
이와 달리 파이썬에서 디버거를 사용하는 가장 쉬운 방법은 프로그램을 수정하여 조사할 만한 문제를 만나기 전에 직접 디버거를 실행하는 것이다.
디버거에서 파이썬 프로그램을 실행하는 것과 평소처럼 실행하는 것 사이에는 별다른 차이가 없다.

디버거를 시작하려면 내장 모듈 pdb를 임포트한 후 set_trace함수를 실행하기만 하면 된다.
보통 이 작업을 한 출로 처리하여 프로그래머가 # 문자하나로 주석 처리할 수 있게 한다.

~~~python
def complex_func(a, b, c):
    ...
    import pdb; pdb.set_trace()
~~~
이 문장을 실행하자마자 프로그램은 실행을 멈춘다.
프로그램을 시작한 터미너른 대화식 파이썬 쉘로 바뀐다.

~~~bash
>>> import pdb; pbd.set_trace()
(Pdb)
~~~

(Pdb) 프롬프트에서 변수의 값을 출력하려면 지역변수의 이름을 입력하면 된다.
내장 함수 locals를 호출하면 모든 지역 변수의 리스트를 볼 수 있다.
이외에도 모듈 임퐅, 전역 상태 조사, 새 객체 생성, 내장 함수 help 실행,
심지어 프로그램의 일부를 수정하는 일을 포함해 디버깅을 보조하는 작업은 무엇이든 할 수 있다.
게다가 디버거는 실행 중인 프로그램을 더 쉽게 조사할 수 있는 명령 세 개를 제공한다.

- bt: 현재 실행 호출 스택의 추적 정보를 출력한다. 이 정보는 프로그램의 어느 부분에 있고, pdb.set_trace 트리거 지점에 어떻게 도달했는 지 보여준다.
- up: 현재 함수의 호출자 쪽으로 함수 호출 스택의 스코프를 이동한다. 이 동작으로 호출 스택의 상위 레벨에서 지역 변수를 조사 할 수 있다.
- down: 함수 호출 스택을 한 단계 낮춘다.

현재 상태를 조사하고 나면 다음과 같은 디버거 명령을 사용하여 좀더 세밀한 제어로 프로그램 실행을 재개 할 수 있다.

- step: 프로그램의 다음 줄까지 실행한 다음 제어를 디버거에 돌려준다. 다음 줄의 실행이 함수 호출을 포함하고 있다면 디버거는 호출된 함수 안에서 바로 멈춘다.
- next: 현재 함수에서 다음 줄까지 프로그램을 실행한 다음 제어를 디버거에 돌려준다. 다음 줄의 실행이 함수 호출을 포함하고 있다면 호출된 함수가 반환할 때가지 디버거가 멈추지 않는다.
- return: 현재 함수가 값을 반환할 때까지 프로그램을 실행한 다음 제어를 디버거에 돌려준다.
- continue: 다음 중단점(혹은 set_trace가 다시 호출 될 때)까지 프로그램 실행을 계속한다.
